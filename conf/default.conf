
map $http_upgrade $connection_upgrade {  
    default upgrade;
    ''      close;
}
log_format loki_optimized escape=json '{'
    '"timestamp": "$time_iso8601", '
    '"level": "info", '
    '"host": "$server_name", '
    '"method": "$request_method", '
    '"uri": "$request_uri", '
    '"status": $status, '
    '"duration": $request_time, '
    '"bytes": $bytes_sent, '
    '"ip": "$remote_addr", '
    '"user_agent": "$http_user_agent", '
    '"referer": "$http_referer", '
    '"scheme": "$scheme", '
    '"upstream": "$upstream_addr", '
    '"upstream_time": "$upstream_response_time", '
    '"cf_ray": "$http_cf_ray"'
'}';

access_log /dev/stdout loki_optimized;
error_log /var/log/nginx-error.log;


	server {
	    listen       80;
	    server_name  keeb.dev;

	    server_tokens off;

	    location /.well-known/acme-challenge/ {
		root /var/www/certbot;
	    }

	    location / {
		return 301 https://$host$request_uri;
	    }
	}


	server {
	    listen       80;
	    server_name  counter.keeb.dev;

	    server_tokens off;

	    location /.well-known/acme-challenge/ {
		root /var/www/certbot;
	    }

	    location / {
		return 301 https://$host$request_uri;
	    }
	}

	server {
	    listen       80;
	    server_name  start.keeb.dev;

	    server_tokens off;

	    location /.well-known/acme-challenge/ {
		root /var/www/certbot;
	    }

	    location / {
		return 301 https://$host$request_uri;
	    }
	}

	server {

	    listen 443;
	    ssl on;
	    server_name keeb.dev;

	    server_tokens off;

	    ssl_certificate /etc/letsencrypt/live/keeb.dev/fullchain.pem;
	    ssl_certificate_key /etc/letsencrypt/live/keeb.dev/privkey.pem;
	    include /etc/letsencrypt/options-ssl-nginx.conf;
	    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	    location / {
		root   /usr/share/nginx/html;
		index  index.html index.htm;
	    }

	    location /static/ {
		alias   /usr/share/nginx/static/;
	    }

	    location /slate/ {
		alias   /usr/share/nginx/slate/;
	    }

	    location /bio/ {
		alias   /usr/share/nginx/bio/;
	    }

	    location /op/ {
		proxy_pass http://100.92.243.19:6969/;
	    }

	    


	    error_page   500 502 503 504 404  /;
	}

	server {

	    listen 443;
	    ssl on;
	    server_name counter.keeb.dev;

	    server_tokens off;

	    ssl_certificate /etc/letsencrypt/live/keeb.dev/fullchain.pem;
	    ssl_certificate_key /etc/letsencrypt/live/keeb.dev/privkey.pem;
	    include /etc/letsencrypt/options-ssl-nginx.conf;
	    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	    location / {
		proxy_pass http://keeb.dev:8000/src/counter.php;
	    }


	    error_page   500 502 503 504 400 /;
	}

	server {

	    listen 443;
	    ssl on;
	    server_name start.keeb.dev;

	    server_tokens off;

	    ssl_certificate /etc/letsencrypt/live/keeb.dev/fullchain.pem;
	    ssl_certificate_key /etc/letsencrypt/live/keeb.dev/privkey.pem;
	    include /etc/letsencrypt/options-ssl-nginx.conf;
	    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	    error_page   500 502 503 504 400 /;

	    location / {
		root   /usr/share/nginx/start;
		index  index.html index.htm;
	    }
	}

	server {

	    listen 443;
	    ssl on;
	    server_name flix.keeb.dev;

	    server_tokens off;

	    ssl_certificate /etc/letsencrypt/live/keeb.dev/fullchain.pem;
	    ssl_certificate_key /etc/letsencrypt/live/keeb.dev/privkey.pem;
	    include /etc/letsencrypt/options-ssl-nginx.conf;
	    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	    location / {
		proxy_pass http://100.92.243.19:8096;
	    }

	    error_page   500 502 503 504 400 /;
	}


	server {
	    listen       80;
	    server_name  si.keeb.dev;

	    server_tokens off;

	    location /.well-known/acme-challenge/ {
		root /var/www/certbot;
	    }

	    location / {
		return 301 https://$host$request_uri;
	    }
	}

	server {

	    listen 443;
	    ssl on;
	    server_name si.keeb.dev;

	    server_tokens off;

	    proxy_http_version 1.1;
	    proxy_set_header Upgrade $http_upgrade;
	    proxy_set_header Connection $connection_upgrade;

	    ssl_certificate /etc/letsencrypt/live/keeb.dev/fullchain.pem;
	    ssl_certificate_key /etc/letsencrypt/live/keeb.dev/privkey.pem;
	    include /etc/letsencrypt/options-ssl-nginx.conf;
	    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	    location / {
		proxy_pass http://100.86.60.111:8080;
	    }

	    error_page   500 502 503 504 400 /;
	}

	server {
	    listen       80;
	    server_name  tilt.keeb.dev;

	    server_tokens off;

	    location /.well-known/acme-challenge/ {
		root /var/www/certbot;
	    }

	    location / {
		return 301 https://$host$request_uri;
	    }
	}

	server {

	    listen 443;
	    ssl on;
	    server_name tilt.keeb.dev;

	    server_tokens off;

	    proxy_http_version 1.1;
	    proxy_set_header Upgrade $http_upgrade;
	    proxy_set_header Connection $connection_upgrade;

	    ssl_certificate /etc/letsencrypt/live/keeb.dev/fullchain.pem;
	    ssl_certificate_key /etc/letsencrypt/live/keeb.dev/privkey.pem;
	    include /etc/letsencrypt/options-ssl-nginx.conf;
	    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	    location / {
		proxy_pass http://100.86.60.111:10350;
	    }
	
	    error_page   500 502 503 504 400 /;
	}


	server {
	    listen       80;
	    server_name  whiskers.keeb.dev;

	    server_tokens off;

	    location /.well-known/acme-challenge/ {
		root /var/www/certbot;
	    }

	    location / {
		return 301 https://$host$request_uri;
	    }
	}

	server {

	    listen 443;
	    ssl on;
	    server_name whiskers.keeb.dev;

	    server_tokens off;

	    proxy_http_version 1.1;
	    proxy_set_header Upgrade $http_upgrade;
	    proxy_set_header Connection $connection_upgrade;

	    ssl_certificate /etc/letsencrypt/live/keeb.dev/fullchain.pem;
	    ssl_certificate_key /etc/letsencrypt/live/keeb.dev/privkey.pem;
	    include /etc/letsencrypt/options-ssl-nginx.conf;
	    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	    location / {
		proxy_pass http://100.86.60.111:3000/;
	    }
	
	    error_page   500 502 503 504 400 /;
	}

	server {
	    listen       80;
	    server_name  localstack.keeb.dev;
	    server_tokens off;

	    proxy_http_version 1.1;
	    proxy_set_header Upgrade $http_upgrade;
	    proxy_set_header Connection $connection_upgrade;


	    location / {
		proxy_pass http://100.92.243.19:4566/;
	    }
	
	    error_page   500 502 503 504 400 /;

	}

	server {
	    listen       80;
	    server_name  vault.keeb.dev;
	    server_tokens off;

	    proxy_http_version 1.1;
	    proxy_set_header Upgrade $http_upgrade;
	    proxy_set_header Connection $connection_upgrade;


	    location / {
		proxy_pass http://100.92.243.19:8200/;
	    }
	
	    error_page   500 502 503 504 400 /;

	}
	server {
	    listen       80;
	    server_name  jaeger.keeb.dev;
	    server_tokens off;

	    proxy_http_version 1.1;
	    proxy_set_header Upgrade $http_upgrade;
	    proxy_set_header Connection $connection_upgrade;


	    location / {
		proxy_pass http://100.86.60.111:3000;
	    }
	
	    error_page   500 502 503 504 400 /;

	}


